function getVenuesAndWeather(e){return e.init()}angular.module("adventureplanner.main",[]),angular.module("adventureplanner.main").factory("weatherService",["$http",function(e){function n(n){n.hasOwnProperty("i")||(n.i=void 0);var r=t(n);return e({url:r,method:"GET",params:{i:n.i}})}function t(e){return"http://api.openweathermap.org/data/2.5/weather?lat="+e.lat+"&lon="+e.lng}var r={get:n};return r}]),angular.module("adventureplanner.main").factory("venueService",["$http",function(e){function n(n){var r=t(n);return e.get(r)}function t(e){function n(e){return Math.floor(Math.random()*e+1)}var t="OICKGWOXVDITIP00YRSWBKZ2JCBE0EIU1KI3GJDMZE1LYZ3O",r="GJ3CMLRXSKTJH1QS5YBADM422IJG5IIJP0Y55DH2ATBDHTPM";return"https://api.foursquare.com/v2/venues/explore?client_id="+t+"&client_secret="+r+"&v=20130815&ll="+e.lat+","+e.lng+"&query="+e.query+"&offset="+n(e.offset)+"&limit="+e.limit+"&radius=130000&sortByDistance=1"}var r={get:n};return r}]),angular.module("adventureplanner.main").factory("nearCityService",["$http",function(e){function n(n){var t=r(n);return e.get(t)}function t(e){var n=parseFloat(e.lat),t=parseFloat(e.lng);return{n:n+1.25,s:n-1.25,e:t+1.25,w:t-1.25}}function r(e){var n=a.findBoundaries(e);return"http://api.geonames.org/citiesJSON?north="+n.n+"&south="+n.s+"&east="+n.e+"&west="+n.w+"&maxRows="+e.maxRows+"&lang=de&username=sturpon711"}var a={get:n,findBoundaries:t,buildRequest:r};return a}]),angular.module("adventureplanner.main").factory("geolocator",["$location","$window","$timeout","dataService",function(e,n,t,r){function a(){n.navigator.geolocation?n.navigator.geolocation.getCurrentPosition(o):console.log("Geolocation is not supported by this browser.")}function o(n){r.currentData.lat=n.coords.latitude,r.currentData.lng=n.coords.longitude,t(function(){e.path("home")},1)}var u={get:a,success:o};return u}]),angular.module("adventureplanner.main").factory("dataService",["venueService","weatherService","nearCityService","$location","$q",function(e,n,t,r,a){function o(){var e={lat:p.currentData.lat,lng:p.currentData.lng};n.get(e).then(function(e){p.currentData.temp=e.data.main.temp,p.currentData.condition=e.data.weather[0].main,p.currentData.name=e.data.name}),p.lat=e.lat,p.lng=e.lng,l()}function u(){p.venues=[],l()}function i(){var e={lat:p.lat,lng:p.lng,offset:p.offset,query:p.userSearchTerm,limit:p.limit,maxRows:p.maxRows};return t.get(e).then(function(e){e.data.geonames.forEach(function(e){p.lat=e.lat,p.lng=e.lng,p.getVenues()})})}function l(){var n={lat:p.lat,lng:p.lng,offset:p.offset,query:p.userSearchTerm,limit:p.limit};return e.get(n).then(function(e){var n=s(e.data.response.groups[0].items);return p.venues=p.venues.concat(n),m(p.venues)}).catch(function(){r.path("landing")}).then(function(){return p.venues.length>1&&(p.venues=c(p.venues)),p.appData=p.venues,p.appData})}function c(e){return e.sort(function(e,n){return e.hasOwnProperty("weather")&&n.hasOwnProperty("weather")&&e.weather.hasOwnProperty("temp")&&n.weather.hasOwnProperty("temp")?e.weather.temp<n.weather.temp?1:e.weather.temp>n.weather.temp?-1:0:void 0})}function s(e){var n=[];return e.forEach(function(e,t){try{n[t]={name:e.venue.name,blurb:e.tips[0].text,lat:e.venue.location.lat,lng:e.venue.location.lng}}catch(r){n[t]={name:e.venue.name,lat:e.venue.location.lat,lng:e.venue.location.lng},console.log("error: ",e)}}),n}function m(e){var t=[];return e.forEach(function(e,r){var a={lat:e.lat,lng:e.lng,i:r},o=h(e.lat,e.lng);e.distance=o;var u=n.get(a).then(function(e){try{var n=e.config.params.i;p.venues[n].weather={temp:e.data.main.temp,condition:e.data.weather[0].main}}catch(t){console.log("Error: ",p.venues)}});t.push(u)}),a.all(t)}function h(e,n){var t=p.currentData.lat,r=p.currentData.lng,a=function(e){return e*Math.PI/180},o=6378137,u=a(e-t),i=a(n-r),l=Math.sin(u/2)*Math.sin(u/2)+Math.cos(a(t))*Math.cos(a(e))*Math.sin(i/2)*Math.sin(i/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),s=o*c;return s}var p={currentData:{name:"",temp:"",condition:"",lat:"",lng:""},expandSearch:i,findDistance:h,getVenues:l,init:o,lat:"",lng:"",limit:10,maxRows:3,newSearch:u,offset:20,parseVenueData:s,sortByTemp:c,userSearchTerm:"mountain",venues:[],appData:[]};return p}]),angular.module("adventureplanner.main").controller("landingCtrl",["$scope","$window","dataService","geolocator",function(e,n,t,r){r.get()}]),angular.module("adventureplanner.main").controller("MainCtrl",["$scope","$window","dataService",function(e,n,t){e.service=t}]),angular.module("adventureplanner",["ngRoute","adventureplanner.main"]).filter("kelvinToF",function(){return function(e){return 1.8*(parseFloat(e)-273.15)+32}}).filter("metersToMiles",function(){return function(e){return e/1609.344}}).config(["$routeProvider",function(e){e.when("/home",{templateUrl:"/adventureplanner/main/displayPlaces.html",controller:"MainCtrl",resolve:{getVenuesAndWeather:getVenuesAndWeather}}).when("/landing",{templateUrl:"/adventureplanner/main/landingPage.html",controller:"landingCtrl"}).otherwise({redirectTo:"/landing"})}]),getVenuesAndWeather.$inject=["dataService"],angular.module("adventureplanner").filter("kelvinToF",function(){return function(e){return 1.8*(parseFloat(e)-273.15)+32}}).filter("metersToMiles",function(){return function(e){return e/1609.344}}).filter("weatherSort",function(){return function(e){return e.sort(function(e,n){return e.hasOwnProperty("weather")&&n.hasOwnProperty("weather")&&e.weather.hasOwnProperty("temp")&&n.weather.hasOwnProperty("temp")?e.weather.temp<n.weather.temp?1:e.weather.temp>n.weather.temp?-1:0:void 0})}}),function(e){try{e=angular.module("adventureplanner")}catch(n){e=angular.module("adventureplanner",[])}e.run(["$templateCache",function(e){e.put("/adventureplanner/main/displayPlaces.html",'<h2>You are in: {{service.currentData.name}}</h2><p>It\'s {{service.currentData.temp | kelvinToF | number:1}} F and {{service.currentData.condition}}</p><form ng-submit="service.newSearch()" ng-controller="MainCtrl">What are you in the mood for: <input ng-model="service.userSearchTerm" name="text"> <input type="submit" id="submit" value="Submit"></form>Or<form ng-submit="service.expandSearch()" ng-controller="MainCtrl"><input type="submit" id="submit" value="Expand Current Search"></form><ul><h1>Results for {{service.userSearchTerm}}</h1><li ng-repeat="venue in service.appData"><h2>{{venue.name}}</h2><p>{{venue.weather.temp | kelvinToF | number:1}} F {{venue.weather.condition}} and {{venue.distance | metersToMiles | number:1}} miles</p><p>{{venue.blurb}}</p></li></ul>')}])}(),function(e){try{e=angular.module("adventureplanner")}catch(n){e=angular.module("adventureplanner",[])}e.run(["$templateCache",function(e){e.put("/adventureplanner/main/landingPage.html","<h2>Getting your location . . .</h2>")}])}();